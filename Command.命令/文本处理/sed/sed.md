# Sed

`sed [-hnV][-e<script>][-f<script文件>][文本文件]`

* Linux sed命令是利用script来处理文本文件。
* sed可依照script的指令，来处理、编辑文本文件。
* Sed主要用来自动编辑一个或多个文件；简化对文件的反复操作；编写转换程序等。


### sed使用参数:

    [root@www ~]# sed [-nefr] [动作]
    选项与参数：


### 注意:

    sed后面接的动作，务必以两个单引号括住。
    使用p(打印)参数时，sed一定要用-n，否则所有的行都会被输出，这样就没有意义了。
    sed默认不直接作用于读取的文件中。
    -i参数要慎用，它会直接修改读取的文件内容。





## 替换部分字符串而不是整行

### ``sed 's/aa/AA/' test.txt``
我们这里说的就是s命令，执行的结果是我们文件中的 aa 被替换成 AA ，我们看一下s命令后面接的是3个斜杠分隔的两串字符串，其含义是   s/待替换的字符串/新字符串/ 也就是说使用后面的 AA 替换文件中出现的前面的 aa 。实际上这里的替换仅仅替换每一行遇到的第一个aa，我们修改一下文件的内容：

可以看到第6行的ccaa中的aa是没有被替换的，也就是说此时仅仅替换了每一行搜索到的第一个aa字符串进行操作，那么如果要对一行里面的所有的符合条件的字符串都做替换操作呢，我们可以使用参数g，例如修改命令如下：

### ``sed 's/aa/AA/g' test.txt``
在最后一个斜杠后面加上g选项之后，表示进行全局替换，也就是说一行中所有符合条件的旧字符串都会被替换成新字符串，而不仅仅是第一个。与其他针对行的操作一样，s命令也可以进行地址选择，其地址使用方法与我们之前的一样，也就是在s的前面加上地址空间限定，例如：

可以看到仅仅对第一行进行了替换操作，其他的地址限定方法同样也是可以使用的，我们可以使用m,n的限定，例如：

### ``sed '5,$s/aa/AA/g' test.txt``

表示对第5行直到文件末尾的所有行进行搜索替换操作，同样s命令的地址限定也支持使用正则表达式限定符合条件的行，然后在这些行中进行字符串的搜索替换操作，例如：

### ``sed '/^[0-9]/s/aa/AA/g' test.txt``
我们在s命令前面添加了 /^[0-9]/ 这个修饰，该正则表达式表示对所有以数字开头的行，执行s操作




## sed正则中的元字符

我们知道sed中的命令前面可以使用地址范围进行限制，表示对文件的某些符合条件的行执行相应的操作，其中我们可以使用正则表达式选出要操作的行，而sed中正则的语法可能与我们其他命令的正则语法有一些不同，这里我们有必要列出sed中常用的正则元字符：

$ 表示行尾 
^ 表示行首
[a-z0-9]表示字符范围
[^]表示除了字符集中的字符以外的字符

sed的正则中  \(\)  和 \{m,n\} 需要转义

. 表示任意字符  
* 表示零个或者多个  
\+ 一次或多次　　
\? 零次或一次    
\| 表示或语法

以上所述是小编给大家介绍的linux sed命令详解，希望对大家有所帮助，如果大家有任何疑问请给我留言，小编会及时回复大家的。在此也非常感谢大家对脚本之家网站的支持！


### sed元字符集:

    ^ 匹配行开始，如：/^sed/匹配所有以sed开头的行;
    $ 匹配行结束，如：/sed$/匹配所有以sed结尾的行;
    . 匹配一个非换行符的任意字符，如：/s.d/匹配s后接一个任意字符，最后是d;
    * 匹配0个或多个字符，如：/*sed/匹配所有模板是一个或多个空格后紧跟sed的行;
    [] 匹配一个指定范围内的字符，如/[ss]ed/匹配sed和Sed;
    [^] 匹配一个不在指定范围内的字符，如：/[^A-RT-Z]ed/匹配不包含A-R和T-Z的一个字母开头，紧跟ed的行;
    \(..\) 匹配子串，保存匹配的字符，如s/\(love\)able/\1rs，loveable被替换成lovers;
    & 保存搜索字符用来替换其他字符，如s/love/**&**/，love这成**love**;
    \< 匹配单词的开始，如:/\ 
    \> 匹配单词的结束，如/love\>/匹配包含以love结尾的单词的行;
    x\{m\} 重复字符x，m次，如：/0\{5\}/匹配包含5个0的行;
    x\{m,\} 重复字符x，至少m次，如：/0\{5,\}/匹配至少有5个0的行;
    x\{m,n\} 重复字符x，至少m次，不多于n次，如：/0\{5,10\}/匹配5~10个0的行;



## sed找到关键字所在行并将其前面的第一个字符删除的命令

sed找到关键字所在行并将其前面的第一个字符删除：

### 代码如下:

    sed -i '/httpd-vhosts/s/^#//'  httpd.conf

即以 httpd-vhosts 为关键字找到这行，并将前面的第一个字符删掉，即将#删掉。












## 数据的搜寻并执行命令

找到匹配模式eastern的行后，

### 搜索/etc/passwd,找到root对应的行，执行后面花括号中的一组命令，每个命令之间用分号分隔，这里把bash替换为blueshell，再输出这行:

    nl /etc/passwd | sed -n '/root/{s/bash/blueshell/;p}'
    1  root:x:0:0:root:/root:/bin/blueshell

### 如果只替换/etc/passwd的第一个bash关键字为blueshell，就退出:

    nl /etc/passwd | sed -n '/bash/{s/bash/blueshell/;p;q}'    
    1  root:x:0:0:root:/root:/bin/blueshell

最后的q是退出。










## 多点编辑

### 一条sed命令，删除/etc/passwd第三行到末尾的数据，并把bash替换为blueshell:

    nl /etc/passwd | sed -e '3,$d' -e 's/bash/blueshell/'
    1  root:x:0:0:root:/root:/bin/blueshell
    2  daemon:x:1:1:daemon:/usr/sbin:/bin/sh

-e表示多点编辑，第一个编辑命令删除/etc/passwd第三行到末尾的数据，第二条命令搜索bash替换为blueshell。



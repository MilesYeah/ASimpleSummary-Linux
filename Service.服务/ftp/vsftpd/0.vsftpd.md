# vsftp


## 匿名访问模式

```sh
[root@localhost ~]# yum -y install vsftpd

[root@localhost ~]# iptables -F
[root@localhost ~]# iptables-save
# Generated by iptables-save v1.8.4 on Tue Nov 30 11:06:04 2021
*filter
:INPUT ACCEPT [155574:295254767]
:FORWARD ACCEPT [0:0]
:OUTPUT ACCEPT [37460:5234086]
:LIBVIRT_INP - [0:0]
:LIBVIRT_OUT - [0:0]
:LIBVIRT_FWO - [0:0]
:LIBVIRT_FWI - [0:0]
:LIBVIRT_FWX - [0:0]
COMMIT
# Completed on Tue Nov 30 11:06:04 2021
# Generated by iptables-save v1.8.4 on Tue Nov 30 11:06:04 2021
*security
:INPUT ACCEPT [45507:277272506]
:FORWARD ACCEPT [0:0]
:OUTPUT ACCEPT [37462:5234526]
COMMIT
# Completed on Tue Nov 30 11:06:04 2021
# Generated by iptables-save v1.8.4 on Tue Nov 30 11:06:04 2021
*raw
:PREROUTING ACCEPT [169728:299556908]
:OUTPUT ACCEPT [37465:5234978]
COMMIT
# Completed on Tue Nov 30 11:06:04 2021
# Generated by iptables-save v1.8.4 on Tue Nov 30 11:06:04 2021
*mangle
:PREROUTING ACCEPT [169728:299556908]
:INPUT ACCEPT [155574:295254767]
:FORWARD ACCEPT [0:0]
:OUTPUT ACCEPT [37467:5235322]
:POSTROUTING ACCEPT [38487:5359193]
:LIBVIRT_PRT - [0:0]
-A POSTROUTING -j LIBVIRT_PRT
-A LIBVIRT_PRT -o virbr0 -p udp -m udp --dport 68 -j CHECKSUM --checksum-fill
COMMIT
# Completed on Tue Nov 30 11:06:04 2021
# Generated by iptables-save v1.8.4 on Tue Nov 30 11:06:04 2021
*nat
:PREROUTING ACCEPT [123224:22161759]
:INPUT ACCEPT [25:1308]
:POSTROUTING ACCEPT [2491:320452]
:OUTPUT ACCEPT [2491:320452]
:LIBVIRT_PRT - [0:0]
-A POSTROUTING -j LIBVIRT_PRT
-A LIBVIRT_PRT -s 192.168.122.0/24 -d 224.0.0.0/24 -j RETURN
-A LIBVIRT_PRT -s 192.168.122.0/24 -d 255.255.255.255/32 -j RETURN
-A LIBVIRT_PRT -s 192.168.122.0/24 ! -d 192.168.122.0/24 -p tcp -j MASQUERADE --to-ports 1024-65535
-A LIBVIRT_PRT -s 192.168.122.0/24 ! -d 192.168.122.0/24 -p udp -j MASQUERADE --to-ports 1024-65535
-A LIBVIRT_PRT -s 192.168.122.0/24 ! -d 192.168.122.0/24 -j MASQUERADE
COMMIT
# Completed on Tue Nov 30 11:06:04 2021
[root@localhost ~]# firewall-cmd --permanent --zone=public --add-service=ftp 
success
[root@localhost ~]# firewall-cmd --reload 
success
[root@localhost ~]# mv /etc/vsftpd/vsftpd.conf /etc/vsftpd/vsftpd.conf_bak
[root@localhost ~]# grep -v "#" /etc/vsftpd/vsftpd.conf_bak > /etc/vsftpd/vsftpd.conf
[root@localhost ~]# cat /etc/vsftpd/vsftpd.conf
anonymous_enable=NO
local_enable=YES
write_enable=YES
local_umask=022
dirmessage_enable=YES
xferlog_enable=YES
connect_from_port_20=YES
xferlog_std_format=YES
listen=NO
listen_ipv6=YES

pam_service_name=vsftpd
userlist_enable=YES
[root@localhost ~]# yum -y install ftp

```

向匿名用户开放的权限参数以及作用
| 参数                        | 作用                               |
| --------------------------- | ---------------------------------- |
| anonymous_enable=YES        | 允许匿名访问模式                   |
| anon_umask=022              | 匿名用户上传文件的umask值          |
| anon_upload_enable=YES      | 允许匿名用户上传文件               |
| anon_mkdir_write_enable=YES | 允许匿名用户创建目录               |
| anon_other_write_enable=YES | 允许匿名用户修改目录名称或删除目录 |

```sh
[root@localhost ~]# vim /etc/vsftpd/vsftpd.conf
[root@localhost ~]# systemctl restart vsftpd
[root@localhost ~]# systemctl enable vsftpd
Created symlink /etc/systemd/system/multi-user.target.wants/vsftpd.service → /usr/lib/systemd/system/vsftpd.service.
[root@localhost ~]# 
[root@localhost ~]# 
[root@localhost ~]# 
[root@localhost ~]# 
[root@localhost ~]# ifconfig | grep 192
        inet 192.168.123.63  netmask 255.255.255.0  broadcast 192.168.123.255
        inet 192.168.122.1  netmask 255.255.255.0  broadcast 192.168.122.255
[root@localhost ~]# 
[root@localhost ~]# ftp 192.168.123.63
Connected to 192.168.123.63 (192.168.123.63).
220 (vsFTPd 3.0.3)
Name (192.168.123.63:root): anonymous
331 Please specify the password.
Password:
230 Login successful.
Remote system type is UNIX.
Using binary mode to transfer files.
ftp> ls
227 Entering Passive Mode (192,168,123,63,21,87).
150 Here comes the directory listing.
drwxr-xr-x    2 0        0               6 Apr 22  2021 pub
226 Directory send OK.
ftp> cd pub
250 Directory successfully changed.
ftp> mkdir miles
550 Permission denied.
ftp> bye
221 Goodbye.
[root@localhost ~]# cat /etc/vsftpd/vsftpd.conf
anonymous_enable=YES
local_enable=YES
write_enable=YES
local_umask=022
dirmessage_enable=YES
xferlog_enable=YES
connect_from_port_20=YES
xferlog_std_format=YES
listen=NO
listen_ipv6=YES

pam_service_name=vsftpd
userlist_enable=YES
[root@localhost ~]# 
```

```sh
[root@localhost ~]# ls -ld /var/ftp/pub
drwxr-xr-x. 2 root root 136 Nov 30 11:14 /var/ftp/pub
[root@localhost ~]# [root@localhost ~]# 
bash: [root@localhost: command not found...
[root@localhost ~]# ^C
[root@localhost ~]# chown -R ftp /var/ftp/pub
[root@localhost ~]# ls -ld /var/ftp/pub
drwxr-xr-x. 2 ftp root 136 Nov 30 11:14 /var/ftp/pub
[root@localhost ~]# ftp 192.168.123.63
Connected to 192.168.123.63 (192.168.123.63).
220 (vsFTPd 3.0.3)
Name (192.168.123.63:root): anonymous
331 Please specify the password.
Password:
230 Login successful.
Remote system type is UNIX.
Using binary mode to transfer files.
ftp> cd pub
250 Directory successfully changed.
ftp> mkdir miles
550 Create directory operation failed.
ftp> bye
221 Goodbye.
[root@localhost ~]# 
```




```sh
[root@localhost ~]# setsebool -P ftpd_full_access=on
[root@localhost ~]# 
```


```sh
[root@localhost ~]# ftp 192.168.123.63
Connected to 192.168.123.63 (192.168.123.63).
220 (vsFTPd 3.0.3)
Name (192.168.123.63:root): anonymous
331 Please specify the password.
Password:
230 Login successful.
Remote system type is UNIX.
Using binary mode to transfer files.
ftp> cd pub
250 Directory successfully changed.
ftp> mkdir miles
257 "/pub/miles" created
ftp> bye
221 Goodbye.
[root@localhost ~]# 
```













## ref
* [第11章 使用Vsftpd服务传输文件](https://www.linuxprobe.com/basic-learning-11.html)
* []()
* []()
* []()
* []()
* []()
* []()
* []()
